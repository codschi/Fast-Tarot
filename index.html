<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>塔羅牌小工具</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background-color: #f5f0ff;
            padding: 20px;
            max-width: 100%;
            margin: 0 auto;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #6B46C1;
            text-align: center;
            margin-bottom: 30px;
        }
        .card {
            border: 2px solid #e2d8f5;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
            background-color: white;
            transform-origin: center;
            opacity: 0;
            transform: translateY(30px);
            animation: cardAppear 0.5s forwards;
        }
        @keyframes cardAppear {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .card:nth-child(2) {
            animation-delay: 0.2s;
        }
        .card:nth-child(3) {
            animation-delay: 0.3s;
        }
        .card:nth-child(4) {
            animation-delay: 0.4s;
        }
        .card:nth-child(5) {
            animation-delay: 0.5s;
        }
        .card:nth-child(6) {
            animation-delay: 0.6s;
        }
        .card:nth-child(7) {
            animation-delay: 0.7s;
        }
        .card:nth-child(8) {
            animation-delay: 0.8s;
        }
        .card:nth-child(9) {
            animation-delay: 0.9s;
        }
        .card:nth-child(10) {
            animation-delay: 1s;
        }
        .card-image-container {
            position: relative;
            width: 180px;
            height: 300px;
            margin: 0 auto 15px;
            perspective: 1000px;
        }
        .card-image-wrapper {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s;
        }
        .card-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            transform-origin: center center;
            position: absolute;
            top: 0;
            left: 0;
            backface-visibility: hidden;
        }
        .card-back {
            width: 100%;
            height: 100%;
            background-color: #6B46C1;
            background-image: linear-gradient(135deg, #805AD5 25%, #6B46C1 25%, #6B46C1 50%, #805AD5 50%, #805AD5 75%, #6B46C1 75%, #6B46C1 100%);
            background-size: 20px 20px;
            border-radius: 10px;
            position: absolute;
            top: 0;
            left: 0;
            backface-visibility: hidden;
            transform: rotateY(0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 24px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        .card-image {
            transform: rotateY(180deg);
        }
        .flipped .card-image-wrapper {
            transform: rotateY(180deg);
        }
        .reversed {
            transform: rotateY(180deg) rotate(180deg) !important;
        }
        .card-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .upright {
            color: #3182CE;
        }
        .reversed-text {
            color: #E53E3E;
        }
        .position {
            font-size: 16px;
            font-weight: 500;
            margin-top: 10px;
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
        }
        .position.upright {
            background-color: #EBF8FF;
            border: 1px solid #BEE3F8;
        }
        .position.reversed-text {
            background-color: #FFF5F5;
            border: 1px solid #FED7D7;
        }
        .suit {
            color: #718096;
            margin-bottom: 10px;
        }
        button {
            background-color: #6B46C1;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #553C9A;
        }
        .quick-btn {
            background-color: #ED8936;
        }
        .quick-btn:hover {
            background-color: #DD6B20;
        }
        .meaning-btn {
            background-color: #38A169;
            padding: 8px 15px;
            margin-top: 10px;
            font-size: 14px;
            width: auto;
            display: inline-block;
        }
        .meaning-btn:hover {
            background-color: #2F855A;
        }
        .meaning-content {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #F0FFF4;
            border-radius: 8px;
            border-left: 4px solid #38A169;
            text-align: left;
        }
        .meaning-content h4 {
            margin-top: 0;
            color: #2F855A;
        }
        .meaning-content p {
            margin-bottom: 8px;
        }
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }
        .card-count {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .card-count label {
            margin-right: 15px;
            font-weight: bold;
        }
        .card-count span {
            margin: 0 10px;
            font-weight: bold;
            font-size: 18px;
        }
        .count-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #6B46C1;
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }
        .count-btn:disabled {
            background-color: #A0AEC0;
            cursor: not-allowed;
        }
        .info {
            text-align: center;
            font-size: 14px;
            color: #718096;
            margin-top: 30px;
            border-top: 1px solid #E2E8F0;
            padding-top: 20px;
        }
        .loading {
            text-align: center;
            font-size: 16px;
            margin: 20px 0;
            color: #6B46C1;
        }
        .random-indicator {
            display: inline-block;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 20px;
            margin-left: 8px;
            background-color: #C6F6D5;
            color: #22543D;
            vertical-align: middle;
        }
        .card-placeholder {
            width: 180px;
            height: 300px;
            margin: 0 auto 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f8f4ff;
            border: 1px dashed #d8c8ff;
            border-radius: 8px;
            color: #6B46C1;
            font-size: 14px;
            text-align: center;
            padding: 10px;
        }
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            .card-image-container {
                width: 140px;
                height: 240px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>塔羅牌抽牌小工具</h1>
        
        <button id="quickDrawBtn" class="quick-btn">
            <span>快速抽一張牌</span>
        </button>
        
        <div class="card-count">
            <label>抽牌數量:</label>
            <button id="decreaseBtn" class="count-btn">-</button>
            <span id="cardCount">1</span>
            <button id="increaseBtn" class="count-btn">+</button>
        </div>
        
        <button id="drawBtn">抽牌</button>
        
        <div id="loadingMsg" class="loading" style="display: none;">正在洗牌並抽牌中...</div>
        <div id="cardContainer"></div>
        
        <div class="info">
            <p>本抽牌系統使用完整的78張塔羅牌組，包含大阿爾卡納和小阿爾卡納。</p>
            <!-- <p>每張牌都有50%的機率為正位或逆位。</p>
            <p>使用Random.org提供的大氣噪聲生成真隨機數，確保抽牌結果的真正隨機性。</p> -->
        </div>
    </div>

    <!-- 塔羅牌意義數據庫 -->
    <script>
        // 塔羅牌意義數據庫
        const tarotMeanings = {
            // 大阿爾卡納牌 (Major Arcana)
            "愚者 (The Fool)": {
                upright: "新的開始、冒險、純真、自發性、自由",
                reversed: "魯莽、冒險、不負責任、不考慮後果"
            },
            "魔術師 (The Magician)": {
                upright: "創造力、技能、力量、行動、專注",
                reversed: "操縱、欺騙、失去專注、未發揮潛力"
            },
            "女祭司 (The High Priestess)": {
                upright: "直覺、潛意識、神秘、內在聲音、智慧",
                reversed: "隱藏的議程、未被聽到的直覺、秘密、未顯現的才能"
            },
            "皇后 (The Empress)": {
                upright: "豐饒、母性、創造、自然、滋養",
                reversed: "依賴、過度保護、創造力阻滯、缺乏成長"
            },
            "皇帝 (The Emperor)": {
                upright: "權威、結構、控制、父親形象、穩定",
                reversed: "控制慾過強、嚴酷、不靈活、過度支配"
            },
            "教皇 (The Hierophant)": {
                upright: "精神指導、傳統、遵循社會規範、宗教",
                reversed: "反叛、非傳統、不合常規、個人信仰系統"
            },
            "戀人 (The Lovers)": {
                upright: "愛、和諧、關係、價值觀調整、選擇",
                reversed: "失衡、誤導、價值觀不匹配、不和諧"
            },
            "戰車 (The Chariot)": {
                upright: "控制、意志力、勝利、果斷、自信",
                reversed: "缺乏控制和方向、侵略、多重方向"
            },
            "力量 (Strength)": {
                upright: "勇氣、說服力、影響、耐心、內在力量",
                reversed: "自我懷疑、弱點、缺乏自信、原始慾望"
            },
            "隱者 (The Hermit)": {
                upright: "反省、獨處、內在尋求、靈性探索、智慧",
                reversed: "孤獨、隔離、排斥、退縮、拒絕幫助"
            },
            "命運之輪 (Wheel of Fortune)": {
                upright: "好運、命運、轉折點、機會、變化",
                reversed: "惡運、外部阻力、失控、延誤、混亂"
            },
            "正義 (Justice)": {
                upright: "公正、真相、法律、因果、平衡",
                reversed: "不公正、不誠實、不負責任、不平衡"
            },
            "吊人 (The Hanged Man)": {
                upright: "犧牲、等待、放棄、新視角、放下",
                reversed: "停滯、拖延、抵抗、不必要的犧牲"
            },
            "死神 (Death)": {
                upright: "結束、改變、轉變、過渡、放下",
                reversed: "抗拒變化、無法前進、延遲的結束、恐懼變化"
            },
            "節制 (Temperance)": {
                upright: "平衡、適度、耐心、目的、和諧",
                reversed: "失衡、過度、失調、急躁、缺乏長遠眼光"
            },
            "惡魔 (The Devil)": {
                upright: "束縛、物質主義、誘惑、執著、性能量",
                reversed: "脫離束縛、獨立、擺脫依賴、重獲力量"
            },
            "高塔 (The Tower)": {
                upright: "突然改變、混亂、啟示、覺醒、真相",
                reversed: "避免災難、延遲改變、恐懼破壞"
            },
            "星星 (The Star)": {
                upright: "希望、信心、啟發、平靜、寧靜",
                reversed: "絕望、失去信心、沉悶、沮喪、冷漠"
            },
            "月亮 (The Moon)": {
                upright: "錯覺、夢境、潛意識、恐懼、直覺",
                reversed: "混亂減輕、恐懼減少、誤解、情緒解放"
            },
            "太陽 (The Sun)": {
                upright: "快樂、活力、樂觀、成功、真相",
                reversed: "低自信、不成功、低落情緒、挫折感"
            },
            "審判 (Judgement)": {
                upright: "反思、重生、內在喚醒、解放、絕對決定",
                reversed: "自我懷疑、未能總結教訓、恐懼改變"
            },
            "世界 (The World)": {
                upright: "完成、成就、旅行、和諧、圓滿",
                reversed: "未完成、匆忙、短視、無法結束"
            },
            
            // 小阿爾卡納牌 (Minor Arcana)
            // 聖杯牌 (Cups)
            "聖杯一 (Ace of Cups)": {
                upright: "愛的開始、直覺、情感上的滿足、創造力",
                reversed: "愛的缺失、情感倒空、創意受阻、感性受阻"
            },
            "聖杯二 (Two of Cups)": {
                upright: "結合、關係、愛情、合作、吸引力",
                reversed: "失衡關係、分離、碎裂的關係、張力"
            },
            "聖杯三 (Three of Cups)": {
                upright: "慶祝、友誼、社交生活、社區、合作",
                reversed: "過度縱慾、小集團排外、逃避性行為"
            },
            "聖杯四 (Four of Cups)": {
                upright: "沉思、評估、不滿、冥想、麻木",
                reversed: "新的希望、覺醒、四處探索、新機會"
            },
            "聖杯五 (Five of Cups)": {
                upright: "失落、遺憾、悲傷、憂慮、悔恨",
                reversed: "接受失去、向前邁進、尋找解決方案"
            },
            "聖杯六 (Six of Cups)": {
                upright: "懷舊、童年、天真、記憶、純真",
                reversed: "活在過去、無憂、幼稚、失去天真"
            },
            "聖杯七 (Seven of Cups)": {
                upright: "選擇、做夢、錯覺、幻想、誘惑",
                reversed: "意誌力、清晰、明確方向、克服誘惑"
            },
            "聖杯八 (Eight of Cups)": {
                upright: "放棄、向前走、尋求意義、離開",
                reversed: "害怕改變、恐懼未知、逃避責任"
            },
            "聖杯九 (Nine of Cups)": {
                upright: "滿足、願望實現、情感穩定、欣賞",
                reversed: "自滿、膚淺的滿足、物質主義、空虛"
            },
            "聖杯十 (Ten of Cups)": {
                upright: "家庭和諧、穩定關係、價值觀一致、和平",
                reversed: "不和諧、不健康的關係、失衡家庭"
            },
            "聖杯侍者 (Page of Cups)": {
                upright: "好奇心、新想法、夢幻、學習",
                reversed: "情感沉重、情緒不穩、壞消息、不成熟"
            },
            "聖杯騎士 (Knight of Cups)": {
                upright: "浪漫、魅力、想像力、信息提供者",
                reversed: "失望、不可靠、冷漠、情感操縱"
            },
            "聖杯皇后 (Queen of Cups)": {
                upright: "同情心、冷靜、深度、情感安全、療癒",
                reversed: "依賴、操縱、情緒化、不安全感"
            },
            "聖杯國王 (King of Cups)": {
                upright: "情感控制、平衡、冷靜、支持、同理心",
                reversed: "情緒不穩、冷漠、操縱、情緒波動"
            },
            
            // 寶劍牌 (Swords)
            "寶劍一 (Ace of Swords)": {
                upright: "清晰、真相揭示、新思想、突破、智力",
                reversed: "混亂思維、真理扭曲、殘酷言語"
            },
            "寶劍二 (Two of Swords)": {
                upright: "困難抉擇、平衡、猶豫、停滯、拒絕看",
                reversed: "混亂減輕、新選擇、走出僵局"
            },
            "寶劍三 (Three of Swords)": {
                upright: "心痛、悲傷、心碎、失望、創傷",
                reversed: "恢復、寬恕、放下、復原"
            },
            "寶劍四 (Four of Swords)": {
                upright: "休息、回顧、冥想、恢復、平靜",
                reversed: "重返生活、恢復活力、行動恢復"
            },
            "寶劍五 (Five of Swords)": {
                upright: "衝突、失敗、挫折、競爭、不誠實",
                reversed: "和解、放下、和平追求"
            },
            "寶劍六 (Six of Swords)": {
                upright: "過渡、變化、離開困境、逐漸癒合",
                reversed: "卡在過去、障礙、困難、延遲"
            },
            "寶劍七 (Seven of Swords)": {
                upright: "欺騙、逃避、詭計、策略、奸詐",
                reversed: "坦白、真相、承認、釋放"
            },
            "寶劍八 (Eight of Swords)": {
                upright: "限制、束縛、困境、受害者心態",
                reversed: "自由、自我釋放、新視角、勇氣"
            },
            "寶劍九 (Nine of Swords)": {
                upright: "焦慮、恐懼、噩夢、擔憂、負擔",
                reversed: "希望、重獲信心、釋放恐懼"
            },
            "寶劍十 (Ten of Swords)": {
                upright: "失敗、結束、痛苦、背叛、絕望",
                reversed: "恢復、轉機、緩慢改善、希望"
            },
            "寶劍侍者 (Page of Swords)": {
                upright: "好奇心、敏銳、警覺、熱情、探索",
                reversed: "分心、謊言、八卦、謠言、延遲"
            },
            "寶劍騎士 (Knight of Swords)": {
                upright: "雄心、行動、決心、勇敢、直接",
                reversed: "魯莽、衝動、好鬥、激進、不負責任"
            },
            "寶劍皇后 (Queen of Swords)": {
                upright: "獨立、直接、聰明、準確、清晰",
                reversed: "冷漠、苦澀、殘忍、自私"
            },
            "寶劍國王 (King of Swords)": {
                upright: "清晰思維、智力權威、真相、理性領導",
                reversed: "冷酷、殘忍、濫用權力、操控"
            },
            
            // 錢幣牌 (Pentacles)
            "錢幣一 (Ace of Pentacles)": {
                upright: "新財富、機會、繁榮、豐富、安全",
                reversed: "錯失機會、物質困難、貪婪"
            },
            "錢幣二 (Two of Pentacles)": {
                upright: "平衡、優先次序、適應性、時間管理",
                reversed: "失衡、過度消耗、無組織、不穩定"
            },
            "錢幣三 (Three of Pentacles)": {
                upright: "協作、技能發展、卓越、團隊合作",
                reversed: "平庸、工作質量低、缺乏團隊合作"
            },
            "錢幣四 (Four of Pentacles)": {
                upright: "保守、安全、蓄積、保護、掌控",
                reversed: "貪婪、物質主義、吝嗇、自私"
            },
            "錢幣五 (Five of Pentacles)": {
                upright: "貧困、困難、孤獨、擔憂、健康問題",
                reversed: "復甦、靈性富足、新資源、尋求幫助"
            },
            "錢幣六 (Six of Pentacles)": {
                upright: "慈善、慷慨、分享、贈予、接收",
                reversed: "自私、債務、不平等、給予目的不純"
            },
            "錢幣七 (Seven of Pentacles)": {
                upright: "耐心、等待回報、評估進度、投資",
                reversed: "缺乏長期規劃、漏財、不耐煩"
            },
            "錢幣八 (Eight of Pentacles)": {
                upright: "學徒期、努力工作、專注、技能提升",
                reversed: "缺乏努力、低品質、沒有雄心"
            },
            "錢幣九 (Nine of Pentacles)": {
                upright: "豪華、獨立、自給自足、財務安全",
                reversed: "物質損失、過度依賴、虛榮"
            },
            "錢幣十 (Ten of Pentacles)": {
                upright: "家庭財富、遺產、穩定、永久成功",
                reversed: "家庭紛爭、失去繼承、破產"
            },
            "錢幣侍者 (Page of Pentacles)": {
                upright: "學習、好學、勤奮、新計劃、熱情",
                reversed: "缺乏思考力、懶惰、不切實際"
            },
            "錢幣騎士 (Knight of Pentacles)": {
                upright: "勤奮、責任感、可靠、耐心、保守",
                reversed: "停滯、懶惰、無聊、固執、拖延"
            },
            "錢幣皇后 (Queen of Pentacles)": {
                upright: "實用、家庭關懷、財務獨立、豐盛",
                reversed: "過於依賴、自私、嫉妒、不安全"
            },
            "錢幣國王 (King of Pentacles)": {
                upright: "富裕、領導力、安全、實際、可靠",
                reversed: "物質主義、頑固、貪婪、過度控制"
            },
            
            // 權杖牌 (Wands)
            "權杖一 (Ace of Wands)": {
                upright: "創造力開始、靈感、源動力、新機會",
                reversed: "創造力受阻、拖延、激情減退"
            },
            "權杖二 (Two of Wands)": {
                upright: "未來計劃、決定、探索、進步、冒險",
                reversed: "恐懼變化、害怕未知、計劃失敗"
            },
            "權杖三 (Three of Wands)": {
                upright: "擴展、遠見、遠方的成功、準備、遠景",
                reversed: "延誤、失去耐心、3人關係問題"
            },
            "權杖四 (Four of Wands)": {
                upright: "慶祝、和諧、婚姻、家庭、團結",
                reversed: "不和諧、過渡、不穩定的基礎"
            },
            "權杖五 (Five of Wands)": {
                upright: "競爭、衝突、分歧、張力、辯論",
                reversed: "避免衝突、團結合作、和諧"
            },
            "權杖六 (Six of Wands)": {
                upright: "勝利、認可、驕傲、信心、成就",
                reversed: "自我懷疑、不安全、自豪感降低"
            },
            "權杖七 (Seven of Wands)": {
                upright: "挑戰、捍衛、堅持、勇氣、決心",
                reversed: "讓步、逃避、壓力過大、優柔寡斷"
            },
            "權杖八 (Eight of Wands)": {
                upright: "快速行動、進展、高效、訊息",
                reversed: "延遲、挫折、降低焦慮、等待"
            },
            "權杖九 (Nine of Wands)": {
                upright: "堅韌、毅力、勇氣、堅守陣地",
                reversed: "疲憊、放棄、無能為力、倦怠"
            },
            "權杖十 (Ten of Wands)": {
                upright: "負擔、責任、壓力、成就感",
                reversed: "壓力釋放、委派、放下負擔"
            },
            "權杖侍者 (Page of Wands)": {
                upright: "探索、激情、探索精神、發現",
                reversed: "非目的性活動、缺乏方向、拖延"
            },
            "權杖騎士 (Knight of Wands)": {
                upright: "能量、激情、行動、冒險、衝動",
                reversed: "延遲、挫折、脾氣暴躁、無方向"
            },
            "權杖皇后 (Queen of Wands)": {
                upright: "自信、決斷、社交、充滿熱情、溫暖",
                reversed: "苛求、嫉妒、不安全、控制慾強"
            },
            "權杖國王 (King of Wands)": {
                upright: "大膽領導、遠見、誠實、靈感",
                reversed: "專制、好鬥、不耐煩、魯莽"
            }
        };
    </script>

    <script>
        // 塔羅牌組數據
        const tarotDeck = [
            // 大阿爾卡納牌 (Major Arcana)
            { name: "愚者 (The Fool)", number: "0", image: "https://upload.wikimedia.org/wikipedia/commons/9/90/RWS_Tarot_00_Fool.jpg" },
            { name: "魔術師 (The Magician)", number: "I", image: "https://upload.wikimedia.org/wikipedia/commons/d/de/RWS_Tarot_01_Magician.jpg" },
            { name: "女祭司 (The High Priestess)", number: "II", image: "https://upload.wikimedia.org/wikipedia/commons/8/88/RWS_Tarot_02_High_Priestess.jpg" },
            { name: "皇后 (The Empress)", number: "III", image: "https://upload.wikimedia.org/wikipedia/commons/d/d2/RWS_Tarot_03_Empress.jpg" },
            { name: "皇帝 (The Emperor)", number: "IV", image: "https://upload.wikimedia.org/wikipedia/commons/c/c3/RWS_Tarot_04_Emperor.jpg" },
            { name: "教皇 (The Hierophant)", number: "V", image: "https://upload.wikimedia.org/wikipedia/commons/8/8d/RWS_Tarot_05_Hierophant.jpg" },
            { name: "戀人 (The Lovers)", number: "VI", image: "https://upload.wikimedia.org/wikipedia/commons/3/3a/RWS_Tarot_06_Lovers.jpg" },
            { name: "戰車 (The Chariot)", number: "VII", image: "https://upload.wikimedia.org/wikipedia/commons/9/9b/RWS_Tarot_07_Chariot.jpg" },
            { name: "力量 (Strength)", number: "VIII", image: "https://upload.wikimedia.org/wikipedia/commons/f/f5/RWS_Tarot_08_Strength.jpg" },
            { name: "隱者 (The Hermit)", number: "IX", image: "https://upload.wikimedia.org/wikipedia/commons/4/4d/RWS_Tarot_09_Hermit.jpg" },
            { name: "命運之輪 (Wheel of Fortune)", number: "X", image: "https://upload.wikimedia.org/wikipedia/commons/3/3c/RWS_Tarot_10_Wheel_of_Fortune.jpg" },
            { name: "正義 (Justice)", number: "XI", image: "https://upload.wikimedia.org/wikipedia/commons/e/e0/RWS_Tarot_11_Justice.jpg" },
            { name: "吊人 (The Hanged Man)", number: "XII", image: "https://upload.wikimedia.org/wikipedia/commons/2/2b/RWS_Tarot_12_Hanged_Man.jpg" },
            { name: "死神 (Death)", number: "XIII", image: "https://upload.wikimedia.org/wikipedia/commons/d/d7/RWS_Tarot_13_Death.jpg" },
            { name: "節制 (Temperance)", number: "XIV", image: "https://upload.wikimedia.org/wikipedia/commons/f/f8/RWS_Tarot_14_Temperance.jpg" },
            { name: "惡魔 (The Devil)", number: "XV", image: "https://upload.wikimedia.org/wikipedia/commons/5/55/RWS_Tarot_15_Devil.jpg" },
            { name: "高塔 (The Tower)", number: "XVI", image: "https://upload.wikimedia.org/wikipedia/commons/5/53/RWS_Tarot_16_Tower.jpg" },
            { name: "星星 (The Star)", number: "XVII", image: "https://upload.wikimedia.org/wikipedia/commons/d/db/RWS_Tarot_17_Star.jpg" },
            { name: "月亮 (The Moon)", number: "XVIII", image: "https://upload.wikimedia.org/wikipedia/commons/7/7f/RWS_Tarot_18_Moon.jpg" },
            { name: "太陽 (The Sun)", number: "XIX", image: "https://upload.wikimedia.org/wikipedia/commons/1/17/RWS_Tarot_19_Sun.jpg" },
            { name: "審判 (Judgement)", number: "XX", image: "https://upload.wikimedia.org/wikipedia/commons/d/dd/RWS_Tarot_20_Judgement.jpg" },
            { name: "世界 (The World)", number: "XXI", image: "https://upload.wikimedia.org/wikipedia/commons/f/ff/RWS_Tarot_21_World.jpg" },
            
            // 小阿爾卡納牌 (Minor Arcana)
            // 聖杯牌 (Cups)
            { name: "聖杯一 (Ace of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/3/36/Cups01.jpg" },
            { name: "聖杯二 (Two of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/f/f8/Cups02.jpg" },
            { name: "聖杯三 (Three of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/7/7a/Cups03.jpg" },
            { name: "聖杯四 (Four of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/3/35/Cups04.jpg" },
            { name: "聖杯五 (Five of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/d/d7/Cups05.jpg" },
            { name: "聖杯六 (Six of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/1/17/Cups06.jpg" },
            { name: "聖杯七 (Seven of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/a/ae/Cups07.jpg" },
            { name: "聖杯八 (Eight of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/6/60/Cups08.jpg" },
            { name: "聖杯九 (Nine of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/2/24/Cups09.jpg" },
            { name: "聖杯十 (Ten of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/8/84/Cups10.jpg" },
            { name: "聖杯侍者 (Page of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/a/ad/Cups11.jpg" },
            { name: "聖杯騎士 (Knight of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/f/fa/Cups12.jpg" },
            { name: "聖杯皇后 (Queen of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/6/62/Cups13.jpg" },
            { name: "聖杯國王 (King of Cups)", suit: "聖杯", image: "https://upload.wikimedia.org/wikipedia/commons/0/04/Cups14.jpg" },
            
            // 寶劍牌 (Swords)
            { name: "寶劍一 (Ace of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/1/1a/Swords01.jpg" },
            { name: "寶劍二 (Two of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/9/9e/Swords02.jpg" },
            { name: "寶劍三 (Three of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/0/02/Swords03.jpg" },
            { name: "寶劍四 (Four of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/b/bf/Swords04.jpg" },
            { name: "寶劍五 (Five of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/2/23/Swords05.jpg" },
            { name: "寶劍六 (Six of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/2/29/Swords06.jpg" },
            { name: "寶劍七 (Seven of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/3/34/Swords07.jpg" },
            { name: "寶劍八 (Eight of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/a/a7/Swords08.jpg" },
            { name: "寶劍九 (Nine of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/2/2f/Swords09.jpg" },
            { name: "寶劍十 (Ten of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/d/d4/Swords10.jpg" },
            { name: "寶劍侍者 (Page of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/4/4c/Swords11.jpg" },
            { name: "寶劍騎士 (Knight of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/b/b0/Swords12.jpg" },
            { name: "寶劍皇后 (Queen of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/d/d4/Swords13.jpg" },
            { name: "寶劍國王 (King of Swords)", suit: "寶劍", image: "https://upload.wikimedia.org/wikipedia/commons/3/33/Swords14.jpg" },
            
            // 錢幣牌 (Pentacles)
            { name: "錢幣一 (Ace of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/f/fd/Pents01.jpg" },
            { name: "錢幣二 (Two of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/9/9f/Pents02.jpg" },
            { name: "錢幣三 (Three of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/4/42/Pents03.jpg" },
            { name: "錢幣四 (Four of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/3/35/Pents04.jpg" },
            { name: "錢幣五 (Five of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/9/96/Pents05.jpg" },
            { name: "錢幣六 (Six of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/a/a6/Pents06.jpg" },
            { name: "錢幣七 (Seven of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/6/6a/Pents07.jpg" },
            { name: "錢幣八 (Eight of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/4/49/Pents08.jpg" },
            { name: "錢幣九 (Nine of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/f/f0/Pents09.jpg" },
            { name: "錢幣十 (Ten of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/4/42/Pents10.jpg" },
            { name: "錢幣侍者 (Page of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/e/ec/Pents11.jpg" },
            { name: "錢幣騎士 (Knight of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/d/d5/Pents12.jpg" },
            { name: "錢幣皇后 (Queen of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/8/88/Pents13.jpg" },
            { name: "錢幣國王 (King of Pentacles)", suit: "錢幣", image: "https://upload.wikimedia.org/wikipedia/commons/1/1c/Pents14.jpg" },
            
            // 權杖牌 (Wands)
            { name: "權杖一 (Ace of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/1/11/Wands01.jpg" },
            { name: "權杖二 (Two of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/0/0f/Wands02.jpg" },
            { name: "權杖三 (Three of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/f/ff/Wands03.jpg" },
            { name: "權杖四 (Four of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/a/a4/Wands04.jpg" },
            { name: "權杖五 (Five of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/9/9d/Wands05.jpg" },
            { name: "權杖六 (Six of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/3/3b/Wands06.jpg" },
            { name: "權杖七 (Seven of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/e/e4/Wands07.jpg" },
            { name: "權杖八 (Eight of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/6/64/Wands08.jpg" },
            { name: "權杖九 (Nine of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/4/4d/Wands09.jpg" },
            { name: "權杖十 (Ten of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/0/0b/Wands10.jpg" },
            { name: "權杖侍者 (Page of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/6/6a/Wands11.jpg" },
            { name: "權杖騎士 (Knight of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/1/16/Wands12.jpg" },
            { name: "權杖皇后 (Queen of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/0/0d/Wands13.jpg" },
            { name: "權杖國王 (King of Wands)", suit: "權杖", image: "https://upload.wikimedia.org/wikipedia/commons/c/ce/Wands14.jpg" }
        ];

        // DOM元素
        const quickDrawBtn = document.getElementById('quickDrawBtn');
        const drawBtn = document.getElementById('drawBtn');
        const cardContainer = document.getElementById('cardContainer');
        const cardCountEl = document.getElementById('cardCount');
        const decreaseBtn = document.getElementById('decreaseBtn');
        const increaseBtn = document.getElementById('increaseBtn');
        const loadingMsg = document.getElementById('loadingMsg');

        // 卡片數量
        let cardCount = 1;
        
        // 隨機數緩存，避免過多的API調用
        let randomNumberCache = [];
        
        // 獲取真隨機數
        async function getTrueRandomNumbers(min, max, count) {
            try {
                const response = await fetch(`https://www.random.org/integers/?num=${count}&min=${min}&max=${max}&col=1&base=10&format=plain&rnd=new`);
                if (!response.ok) {
                    throw new Error('無法從Random.org獲取隨機數');
                }
                
                const data = await response.text();
                return data.trim().split('\n').map(Number);
            } catch (error) {
                console.warn('使用真隨機數時出錯:', error);
                
                // 返回使用偽隨機數生成的數字
                return Array.from({length: count}, () => Math.floor(Math.random() * (max - min + 1)) + min);
            }
        }
        
        // 獲取單個隨機數（從緩存或新獲取）
        async function getRandomNumber(min, max) {
            // 如果緩存中有數字，從緩存中取並調整到正確範圍
            if (randomNumberCache.length > 0) {
                // 從緩存中取得一個隨機數
                const cachedNumber = randomNumberCache.pop();
                
                // 將緩存中的數字(0-100範圍)映射到需要的範圍(min-max)
                // 確保產生的隨機數在min和max之間
                return min + (cachedNumber % (max - min + 1));
            }
            
            // 否則獲取新的一批隨機數（使用實際需要的範圍）
            try {
                const newNumbers = await getTrueRandomNumbers(min, max, 20);
                randomNumberCache = newNumbers;
                return randomNumberCache.pop() || Math.floor(Math.random() * (max - min + 1)) + min;
            } catch (error) {
                console.error('無法獲取真隨機數:', error);
                // 如果無法獲取真隨機數，則使用偽隨機數
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }
        }
        
        // 獲取布爾隨機值（是/否）
        async function getRandomBoolean() {
            const num = await getRandomNumber(0, 1);
            return num === 1;
        }
        
        // 更新卡片數量顯示
        function updateCardCount() {
            cardCountEl.textContent = cardCount;
            decreaseBtn.disabled = cardCount <= 1;
            increaseBtn.disabled = cardCount >= 10;
        }

        // 增加卡片數量
        increaseBtn.addEventListener('click', () => {
            if (cardCount < 10) {
                cardCount++;
                updateCardCount();
            }
        });

        // 減少卡片數量
        decreaseBtn.addEventListener('click', () => {
            if (cardCount > 1) {
                cardCount--;
                updateCardCount();
            }
        });

        // 顯示卡片涵義
        function toggleMeaning(cardId) {
            const meaningContent = document.getElementById(`meaning-${cardId}`);
            if (meaningContent.style.display === 'none' || meaningContent.style.display === '') {
                meaningContent.style.display = 'block';
            } else {
                meaningContent.style.display = 'none';
            }
        }

        // 創建卡片內容
        function createCardContent(card, isReversed, cardId) {
            // 安全檢查：確保卡片數據存在
            if (!card) {
                console.error('嘗試創建無效的卡片');
                return '<div class="card-placeholder">無效的卡片數據</div>';
            }
            
            // 獲取卡片涵義
            const meaning = tarotMeanings[card.name] || { 
                upright: "暫無解讀資料", 
                reversed: "暫無解讀資料" 
            };
            
            // 確定應該顯示的涵義（正位或逆位）
            const meaningText = isReversed ? meaning.reversed : meaning.upright;
            
            // 創建卡片結構
            return `
                <div class="card-image-container">
                    <div class="card-image-wrapper">
                        <div class="card-back"></div>
                        <img src="${card.image}" class="card-image ${isReversed ? 'reversed' : ''}" alt="${card.name}" onerror="this.onerror=null; this.parentNode.innerHTML='<div class=\\'card-placeholder\\'>圖片無法載入</div>';">
                    </div>
                </div>
                <div class="card-name ${isReversed ? 'reversed-text' : 'upright'}">
                    ${card.number ? card.number + ' - ' : ''}${card.name}
                </div>
                ${card.suit ? `<div class="suit">牌組：${card.suit}</div>` : ''}
                <div class="position ${isReversed ? 'reversed-text' : 'upright'}">
                    ${isReversed ? '逆位 ↓' : '正位 ↑'}
                </div>
                <button class="meaning-btn" onclick="toggleMeaning('${cardId}')">查看解讀</button>
                <div id="meaning-${cardId}" class="meaning-content">
                    <h4>${isReversed ? '逆位解讀' : '正位解讀'}</h4>
                    <p>${meaningText}</p>
                </div>
            `;
        }

        // 抽牌函數
        async function drawCards() {
            // 顯示加載訊息
            loadingMsg.style.display = 'block';
            
            // 清空卡片容器
            cardContainer.innerHTML = '';
            
            try {
                // 創建牌組副本
                const deckCopy = [...tarotDeck];
                
                if (deckCopy.length === 0) {
                    throw new Error('牌組為空');
                }
                
                // 抽指定數量的牌
                for (let i = 0; i < cardCount; i++) {
                    if (deckCopy.length === 0) break;
                    
                    // 隨機選一張牌 - 範圍從0到當前牌組長度減1
                    const randomIndex = await getRandomNumber(0, deckCopy.length - 1);
                    
                    // 安全檢查：確保索引在有效範圍內
                    if (randomIndex < 0 || randomIndex >= deckCopy.length) {
                        console.error(`無效的隨機索引: ${randomIndex}, 牌組長度: ${deckCopy.length}`);
                        continue;
                    }
                    
                    const card = deckCopy.splice(randomIndex, 1)[0];
                    
                    // 隨機決定正逆位
                    const isReversed = await getRandomBoolean();
                    
                    // 創建唯一ID
                    const cardId = `card-${i}-${Date.now()}`;
                    
                    // 創建卡片元素
                    const cardElement = document.createElement('div');
                    cardElement.className = 'card';
                    
                    // 設置卡片內容
                    cardElement.innerHTML = createCardContent(card, isReversed, cardId);
                    
                    // 添加到容器
                    cardContainer.appendChild(cardElement);
                    
                    // 延遲一下再翻牌，製造動畫效果
                    setTimeout(() => {
                        const cardImageWrapper = cardElement.querySelector('.card-image-wrapper');
                        cardImageWrapper.parentNode.classList.add('flipped');
                    }, 500 + i * 300); // 每張牌依次翻開
                }
            } catch (error) {
                console.error('抽牌過程中出錯:', error);
                // 發生錯誤時，使用原始的偽隨機方法作為備用
                fallbackDrawCards();
            } finally {
                // 隱藏加載訊息
                loadingMsg.style.display = 'none';
            }
        }
        
        // 備用的偽隨機抽牌函數（在真隨機失敗時使用）
        function fallbackDrawCards() {
            console.log('使用備用偽隨機抽牌');
            // 創建牌組副本
            const deckCopy = [...tarotDeck];
            
            // 抽指定數量的牌
            for (let i = 0; i < cardCount; i++) {
                if (deckCopy.length === 0) break;
                
                // 隨機選一張牌
                const randomIndex = Math.floor(Math.random() * deckCopy.length);
                const card = deckCopy.splice(randomIndex, 1)[0];
                
                if (!card) continue; // 安全檢查
                
                // 隨機決定正逆位
                const isReversed = Math.random() > 0.5;
                
                // 創建唯一ID
                const cardId = `card-${i}-${Date.now()}`;
                
                // 創建卡片元素
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                
                // 設置卡片內容
                cardElement.innerHTML = createCardContent(card, isReversed, cardId);
                
                // 添加到容器
                cardContainer.appendChild(cardElement);
                
                // 延遲一下再翻牌，製造動畫效果
                setTimeout(() => {
                    const cardImageWrapper = cardElement.querySelector('.card-image-wrapper');
                    cardImageWrapper.parentNode.classList.add('flipped');
                }, 500 + i * 300); // 每張牌依次翻開
            }
        }

        // 快速抽一張牌
        quickDrawBtn.addEventListener('click', async () => {
            cardCount = 1;
            updateCardCount();
            await drawCards();
        });

        // 一般抽牌
        drawBtn.addEventListener('click', async () => {
            await drawCards();
        });

        // 初始化
        updateCardCount();
        
        // 設置全局函數讓按鈕可以調用
        window.toggleMeaning = toggleMeaning;
        
        // 初始加載一些隨機數到緩存 - 使用較小的範圍(0-100)
        getTrueRandomNumbers(0, 100, 40)
            .then(numbers => {
                randomNumberCache = numbers;
                console.log('已預加載真隨機數');
            })
            .catch(error => {
                console.warn('初始加載隨機數失敗:', error);
            });
    </script>
</body>
</html>